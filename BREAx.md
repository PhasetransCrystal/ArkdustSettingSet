# BreaClimate

天气系统应该的构成应该是：

- ClimateElement层，决定当前的某一天气特性分量，例如风向，湿度等。
  需要实现方法，通过Random与GameTime来计算接下来的n时间内的数值为x
  注册中应提供一个空实例，用于当一个维度不具有此值时作为回落值。
  > 在数据存储时，可能需要存储一个seed作为随机种子。在非模拟变化时，该种子应根据随机源与实例数据更新；模拟状态下不更新种子。
  > 应将数据存储从气候元素中提取为一个单独的类，通过气候元素提供codec。
  > 另外，为维度或群系注册气候元素时，应允许指定为不变型。
- WeatherCreator层，需提供有关控制的气候元素，在对应元素变动时解算是否进入天气状态。
  内置一个ticker，用于平滑从各个状态间过渡。这个状态系统将实现客户端同步，并预留强度因子用于控制着色器等渲染效果的叠加。
  > ticker可能需要一个立即完成的方法预留
- Weather为天气，除了常规信息外还有一个动态的强度因子传入，决定天气的效果。
  统一控制天气状态下的：服务端玩家周围场景变化，客户端着色器附加，特殊渲染附加，粒子效果生成。
- BiomeClimateGroup与LevelBiomeClimateGroup决定了维度全局和群系独有的气候特征，
  同时群系组接入维度组间，组接入天气间均可以根据实例决定强度比例系数，
  同时预留天气再修改方法，传参为当前各生效天气及其强度系数(不计入ticker渐变强度)，可以精细修改各种天气之间的冲突问题。
  这一再修改方法在群系组与维度组均有存在，优先在群系组执行，回落至维度组。

需要一个睡眠结束事件监听器(`SleepFinishedTimeEvent`)用于处理睡觉跳过的时间。从世界`getDayTime`就能获取到世界总时间。
也许需要考虑是否应该mixin setTime指令以处理非常规的时间设置。

天气视觉效果的构建应参考原版，分为天气粒子与天气渲染。

- 天气粒子用于模拟碰撞效果等与环境交互的效果，更为逼真但是数量更少
- 天气渲染可以大量构造中院距离的渲染场景，对性能压力较小。
# 超距离物流 CalciteTransfer(clct_transfer)

超距离物流网络有跨距离和跨维度两种，造价不同，功能不同。

在正常情况下，我们希望能以“离散产出-集中处理-跨区域存储”的形式展现流程。
具体而言，我们可以在矿点采集矿物，使用有地区限制的机器生产产物，通过超距离网络生产高级产物，最终通过跨维度运输转移至核心区存储。

这部分功能或与据点系统密切相关。据点决定了有效交通覆盖范围等信息。

## 跨距率物流

跨距率物流由`核心`与`站点`两部分组成，分为`网络请求`与`p2p`两种模式：

- `核心`是非实体的，又称为物流网络频道，由核心信息与核心类型构成。
  核心类型决定了该核心能使用哪些`运输方式`，核心信息存储着这一物流网络频道的升级等信息。
- `站点`是实体的，负责通过物流网络传输资源内容。
  站点的类型决定了其功能，同时存储着内容资源与升级等信息。

两种模式分别对应着资源传输的逻辑：

- `网络请求`模式下，`请求模式发送站点`只作为存储器，在内存更新时提醒网络总存储更新；主网则将`请求模式接收站点`
  的方块实体标记为需要重新检索。
  `请求模式接收站点`则会周期性检查更新状态，并尝试从`请求模式发送站点`获取每份需求清单所需的物品。
  只有当一份需求清单内的所有内容都被满足时，才会向所有发送站点发送运输信号。站点容量限制了单次最多请求份数，也可以手动设置。
- `p2p`模式下，整个逻辑正好相反，`p2p模式接收站点`在内存更新时将自己标记为已更新；
  `p2p模式发送站点`则会周期性检查指定的接受站点是否有更新，并尝试将存储的内容发送往接收站点。

站点大致可以划分为`接收站点`与`发送站点`：

- `发送站点`具有额外的燃料容器，根据`运输方式`及站点间距消耗对应量的对应种类燃料。
- `接收站点`的容器需要实现占用预定功能，这部分对应的资源暂时不存储在站点实体内，但是正在运输途中。
  另外，站点也可以指定其偏好的运输模式优先级。

### 运输

`核心`的类型决定了其可用的`运输方式`，常规的有：公路，铁路，电动铁路，航空，传送；特殊的体系中允许使用航运等方式。
每种`运输方式`内分等级，不同等级将有不同的运输速度和不同的单位距离资源消耗，同时需要额外的建设材料，维护成本。

当一个运输任务被确定时，资源将从`发送站点`被扣除，并将带有时间的运输任务提交至网络。
当时间结束后，`接收站点`将获得这部分资源。

### 升级

对于`核心`而言，可以升级的内容有：最大网络站点数量，最大覆盖半径，各种运输方式的等级。
其中前两项可通过某公式f(c,r)获得为一个值；运输方式升级，维护的资源需求量与值呈正相关；当这个值增加时，也需要补齐运输方式建设的资源投入。

对于`站点`而言，可以升级的内容有：站点内资源容量，运输方式支持；如果为`请求模式接收站点`，则还能升级请求清单可用量。

### 并入

当一个`站点`被尝试并入网络时，网络会优先检查当前站点量是否未满；
若未满，则会尝试计算囊括所有`站点`与`网络控制器`的最小圆，并检查是否小于最大半径。

若满足上述条件，站点即可被并入网络。

### 技术细节

`物流网络`作为一个独立的系统运行。

其存储的信息应包括但不限于：

- 所处的`维度` 。
- 其所拥有的`站点`的位置，名字，UUID。实例化状态下应有可空的站点方块实体实例列表。
- 网络的创建者及使用权限名单。
- 运输任务状态表，允许`接收站点`查询途中运输内容。

物流网络可能需要有一套日志系统。

站点多方块实体可能处于实例化但不成型的阶段。所有阶段的实例化实体都可以被网络引用，但只有成型状态站点可以执行任务。
站点方块实体应在加载与卸载时自动尝试将自己引用与解除至物流网络实例。

站点成型进入可执行任务状态时，应尝试处理曾请求且在卸载期间已运达的运输任务。